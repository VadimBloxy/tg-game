<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>TEXT_PARKOUR_FIXED</title>
    <style>
        body { margin: 0; background: #050505; color: #fff; font-family: monospace; overflow: hidden; }
        #player { 
            position: absolute; width: 30px; height: 30px; 
            background: #0077ff; box-shadow: 0 0 20px #0077ff; z-index: 100;
        }
        .word { 
            position: absolute; background: #222; color: #0f0; 
            padding: 10px; border: 1px solid #0f0; white-space: nowrap;
        }
        #exit { 
            position: fixed; top: 50px; left: 50%; transform: translateX(-50%);
            padding: 20px; border: 3px solid gold; color: gold; font-size: 30px;
        }
        #input-cont {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
        }
        input { 
            padding: 15px; width: 300px; background: #000; color: #fff; 
            border: 2px solid #0077ff; outline: none; font-size: 20px;
        }
    </style>
</head>
<body>

    <div id="exit">ВЫХОД ЗДЕСЬ</div>
    <div id="player"></div>
    <div class="word" style="top: 500px; left: 100px;">СТАРТОВАЯ ПЛОЩАДКА</div>

    <div id="input-cont">
        <input type="text" id="inp" placeholder="Пиши и жми ENTER...">
    </div>

<script>
    const player = { el: document.getElementById('player'), x: 150, y: 400, vx: 0, vy: 0, onG: false };
    const inp = document.getElementById('inp');
    const words = [];

    // Добавляем стартовую платформу в список для коллизий
    words.push(document.querySelector('.word'));

    window.onkeydown = (e) => {
        if(e.code === 'Enter') {
            if(document.activeElement !== inp) {
                inp.focus();
            } else {
                if(inp.value.trim() !== "") {
                    const w = document.createElement('div');
                    w.className = 'word';
                    w.innerText = inp.value;
                    // Создаем прямо под ногами
                    w.style.left = (player.x - 20) + 'px';
                    w.style.top = (player.y + 40) + 'px';
                    document.body.appendChild(w);
                    words.push(w);
                }
                inp.value = "";
                inp.blur(); // Возвращаем управление персонажу
            }
        }
        keys[e.code] = true;
    };
    window.onkeyup = (e) => keys[e.code] = false;

    const keys = {};

    function loop() {
        // Управление (только если не в инпуте)
        if(document.activeElement !== inp) {
            if(keys['ArrowLeft'] || keys['KeyA']) player.vx = -6;
            else if(keys['ArrowRight'] || keys['KeyD']) player.vx = 6;
            else player.vx *= 0.8;

            if((keys['ArrowUp'] || keys['KeyW']) && player.onG) {
                player.vy = -16;
                player.onG = false;
            }
        } else {
            player.vx = 0;
        }

        player.vy += 0.8;
        player.x += player.vx;
        player.y += player.vy;

        // Пол
        if(player.y > window.innerHeight) { player.y = 0; player.x = 150; } // Упал - респаун сверху

        // Коллизии
        player.onG = false;
        words.forEach(w => {
            const r = w.getBoundingClientRect();
            if(player.x + 30 > r.left && player.x < r.right && 
               player.y + 30 > r.top && player.y + 30 < r.top + 20 && player.vy >= 0) {
                player.y = r.top - 30;
                player.vy = 0;
                player.onG = true;
            }
        });

        // Проверка победы
        const exit = document.getElementById('exit').getBoundingClientRect();
        if(player.x + 30 > exit.left && player.x < exit.right && player.y < exit.bottom && player.y + 30 > exit.top) {
            alert("КРАСАВА! ВЫШЕЛ!");
            location.reload();
        }

        player.el.style.left = player.x + 'px';
        player.el.style.top = player.y + 'px';
        requestAnimationFrame(loop);
    }
    loop();
</script>
</body>
</html>
