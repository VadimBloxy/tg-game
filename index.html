<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CYBER WESTERN: OMEGA 5K EDITION</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        body { margin: 0; background: #020202; color: #00ff41; font-family: 'Press Start 2P', cursive; overflow: hidden; display: flex; justify-content: center; align-items: center; height: 100vh; }
        #game-frame { width: 1100px; height: 850px; border: 5px solid #111; background: #000; display: grid; grid-template-rows: 70px 1fr 230px; box-shadow: 0 0 100px rgba(0,255,65,0.1); }
        header { background: #080808; border-bottom: 3px solid #00ff41; display: flex; justify-content: space-around; align-items: center; font-size: 12px; }
        #main-view { display: flex; border-bottom: 3px solid #00ff41; background: #050505; }
        canvas { image-rendering: pixelated; width: 750px; height: 100%; cursor: crosshair; }
        aside { width: 350px; background: #080808; border-left: 2px solid #222; padding: 15px; overflow-y: auto; font-size: 10px; }
        #log-area { padding: 15px; font-family: monospace; font-size: 14px; overflow-y: scroll; border-right: 2px solid #222; color: #00ff41; }
        #ui-panel { display: grid; grid-template-columns: 1fr 350px; background: #000; }
        #actions { display: flex; flex-direction: column; gap: 10px; padding: 15px; justify-content: center; }
        .btn { padding: 12px; background: #000; border: 2px solid #00ff41; color: #00ff41; font-family: inherit; cursor: pointer; text-transform: uppercase; font-size: 11px; }
        .btn:hover { background: #00ff41; color: #000; box-shadow: 0 0 20px #00ff41; }
        .btn:disabled { border-color: #333; color: #333; cursor: not-allowed; }
        .btn-blue { border-color: #00ccff; color: #00ccff; }
        .btn-blue:hover { background: #00ccff; color: #000; box-shadow: 0 0 20px #00ccff; }
        .item-card { border: 1px solid #333; padding: 8px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
        .rarity-common { color: #aaa; }
        .rarity-rare { color: #00ccff; text-shadow: 0 0 5px #00ccff; }
        .rarity-legendary { color: #ff00ff; text-shadow: 0 0 10px #ff00ff; }
    </style>
</head>
<body>

<div id="game-frame">
    <header>
        <div>HP: <span id="hp">100</span></div>
        <div>SP: <span id="sp">100</span></div>
        <div>LVL: <span id="lvl">1</span></div>
        <div>SCRAP: <span id="scrap">0</span></div>
        <div>CREDITS: <span id="cash">50</span></div>
    </header>

    <div id="main-view">
        <canvas id="screen" width="750" height="550"></canvas>
        <aside id="inventory">
            <h3 style="color:#ffcc00">SYSTEMS / GEAR</h3>
            <div id="active-drone" style="margin-bottom:15px; color:#00ccff">NO ACTIVE DRONE</div>
            <h3 style="color:#ffcc00">INVENTORY</h3>
            <div id="inv-list"></div>
            <h3 style="color:#ffcc00">CRAFTING</h3>
            <button class="btn" style="width:100%; margin-bottom:5px;" onclick="game.craft('drone')">CRAFT DRONE (15 SCRAP)</button>
            <button class="btn" style="width:100%" onclick="game.craft('heal')">STIMPACK (2 SCRAP)</button>
        </aside>
    </div>

    <div id="ui-panel">
        <div id="log-area"></div>
        <div id="actions">
            <button id="btn-explore" class="btn" onclick="game.explore()">EXPLORE SECTOR</button>
            <div style="display:flex; gap:10px">
                <button id="btn-atk" class="btn" style="flex:1" onclick="game.combatStep('atk')" disabled>FIRE</button>
                <button id="btn-dead" class="btn btn-blue" style="flex:1" onclick="game.combatStep('dead')" disabled>DEADEYE</button>
            </div>
            <button id="btn-stim" class="btn" onclick="game.useHeal()">USE STIMPACK (0)</button>
        </div>
    </div>
</div>

<script>
/** * ЧАСТЬ 1: ГРАФИКА И МОДЕЛИ
 */
const Sprites = {
    // Реалистичный Ковбой (16x18)
    Player: [
        [0,0,0,0,0,1,1,1,1,1,1,0,0,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0], // Шляпа
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,1,0,1,1,1,1,1,0,1,0,0,0,0], // Лицо
        [0,0,0,1,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,1,1,1,1,1,1,1,1,1,1,1,1,0,0], // Плащ
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0],
        [1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1], // Руки/Оружие
        [1,1,1,0,1,1,1,1,1,1,1,1,0,1,1,1],
        [0,0,0,0,1,1,1,1,1,1,1,1,0,0,0,0],
        [0,0,0,0,1,1,1,0,1,1,1,1,0,0,0,0],
        [0,0,0,0,1,1,0,0,0,1,1,0,0,0,0,0], // Ноги
        [0,0,0,1,1,1,0,0,0,1,1,1,0,0,0,0]
    ],
    // Враг: Тяжелый робот
    Bot: [[0,1,1,1,1,0],[1,1,0,0,1,1],[1,1,1,1,1,1],[0,1,1,1,1,0],[0,1,0,0,1,0],[1,1,0,0,1,1]],
    // Дрон MK-III
    MK3: [[0,1,1,1,0],[1,1,1,1,1],[1,0,1,0,1],[1,1,1,1,1],[1,0,0,0,1]],
    // Уточка
    Duck: [[0,1,1,0],[1,1,0,1],[1,1,1,1],[0,1,1,0]]
};

/**
 * ЧАСТЬ 2 & 3: ДВИЖОК И ЛОГИКА
 */
class CyberEngine {
    constructor() {
        this.canvas = document.getElementById('screen');
        this.ctx = this.canvas.getContext('2d');
        this.logArea = document.getElementById('log-area');
        
        this.p = { 
            hp: 100, maxHp: 100, sp: 100, scrap: 0, cash: 50, lvl: 1, xp: 0,
            inv: [], stims: 2, drone: null 
        };
        
        this.enemy = null;
        this.state = 'IDLE';
        this.shake = 0;

        this.init();
    }

    init() {
        this.log("SYSTEM: КИБЕР-ВЕСТЕРН ЗАГРУЖЕН. УДАЧИ, ПАРТНЕР.");
        this.loop();
        this.updateUI();
    }

    log(m, c = "#00ff41") {
        this.logArea.innerHTML += `<div style="color:${c}">> ${m}</div>`;
        this.logArea.scrollTop = this.logArea.scrollHeight;
    }

    updateUI() {
        document.getElementById('hp').innerText = this.p.hp;
        document.getElementById('sp').innerText = this.p.sp;
        document.getElementById('lvl').innerText = this.p.lvl;
        document.getElementById('scrap').innerText = this.p.scrap;
        document.getElementById('cash').innerText = this.p.cash;
        document.getElementById('btn-stim').innerText = `USE STIMPACK (${this.p.stims})`;
        
        const inv = document.getElementById('inv-list');
        inv.innerHTML = "";
        this.p.inv.forEach((it, i) => {
            let rarityCls = it.rarity === 'LEGENDARY' ? 'rarity-legendary' : (it.rarity === 'RARE' ? 'rarity-rare' : 'rarity-common');
            inv.innerHTML += `
                <div class="item-card">
                    <span class="${rarityCls}">${it.name}</span>
                    ${it.type==='drone' ? `<button class="btn" style="padding:2px 5px" onclick="game.equip(${i})">EQ</button>` : ''}
                </div>`;
        });
        
        if(this.p.drone) {
            document.getElementById('active-drone').innerText = `ACTIVE: ${this.p.drone.name}`;
        }
    }

    // --- КРАФТ С ШАНСАМИ ---
    craft(type) {
        if(type === 'heal') {
            if(this.p.scrap >= 2) { this.p.scrap -= 2; this.p.stims++; this.log("Скрафтил стимулятор."); }
            else this.log("Недостаточно хлама!", "red");
        }
        if(type === 'drone') {
            if(this.p.scrap >= 15) {
                this.p.scrap -= 15;
                let r = Math.random() * 100;
                let d = null;
                if(r < 10) d = { name: "MK-III EXECUTIONER", dmg: 35, rarity: 'LEGENDARY', type: 'drone' };
                else if(r < 35) d = { name: "MK-II STALKER", dmg: 18, rarity: 'RARE', type: 'drone' };
                else if(r < 85) d = { name: "MK-I SCRAPPY", dmg: 8, rarity: 'COMMON', type: 'drone' };
                
                if(d) {
                    this.p.inv.push(d);
                    this.log(`УСПЕХ! Собрал ${d.name}`, d.rarity === 'LEGENDARY' ? '#ff00ff' : '#00ccff');
                } else {
                    this.log("КРАФТ ПРОВАЛЕН. ДЕТАЛИ СГОРЕЛИ.", "red");
                    this.shake = 10;
                }
            } else this.log("Нужно 15 ед. хлама!", "red");
        }
        this.updateUI();
    }

    equip(i) {
        this.p.drone = this.p.inv[i];
        this.log(`Дрон ${this.p.drone.name} выведен на орбиту.`);
        this.updateUI();
    }

    // --- ГЕЙМПЛЕЙ ---
    explore() {
        if(this.state === 'COMBAT') return;
        this.shake = 5;
        if(Math.random() > 0.6) {
            this.state = 'COMBAT';
            this.enemy = { name: "ROBO-BANDIT", hp: 40 + (this.p.lvl*10), maxHp: 40 + (this.p.lvl*10), dmg: 8 + this.p.lvl };
            this.log(`ВРАГ ОБНАРУЖЕН: ${this.enemy.name}`, "red");
            this.toggleCombatUI(true);
        } else {
            let find = Math.floor(Math.random()*5)+1;
            this.p.scrap += find;
            this.log(`Нашел немного хлама: +${find}`);
            if(Math.random() < 0.2) this.log("Нашел резиновую уточку... Она бесполезна, но милая.", "yellow");
        }
        this.updateUI();
    }

    combatStep(type) {
        if(!this.enemy) return;
        let dmg = 0;
        if(type === 'atk') dmg = 10 + Math.floor(Math.random()*10);
        if(type === 'dead') {
            if(this.p.sp >= 40) { this.p.sp -= 40; dmg = 40 + Math.floor(Math.random()*20); this.log("DEADEYE! Точный выстрел!"); }
            else { this.log("Мало SP!", "orange"); return; }
        }

        this.enemy.hp -= dmg;
        if(this.p.drone) {
            this.enemy.hp -= this.p.drone.dmg;
            this.log(`Дрон атаковал: -${this.p.drone.dmg} HP`, "#00ccff");
        }

        if(this.enemy.hp <= 0) {
            this.log(`ПОБЕДА! +${this.enemy.maxHp/2} XP`, "gold");
            this.p.xp += this.enemy.maxHp/2;
            this.p.cash += 20;
            if(this.p.xp >= 100) { this.p.lvl++; this.p.xp = 0; this.log("LEVEL UP!", "cyan"); }
            this.enemy = null;
            this.state = 'IDLE';
            this.toggleCombatUI(false);
        } else {
            // Ответка
            let eDmg = Math.floor(Math.random()*this.enemy.dmg);
            this.p.hp -= eDmg;
            this.log(`${this.enemy.name} попал по тебе: -${eDmg} HP`, "red");
            if(this.p.hp <= 0) { alert("ВЫ ПОГИБЛИ."); location.reload(); }
        }
        this.updateUI();
    }

    useHeal() {
        if(this.p.stims > 0) { this.p.stims--; this.p.hp = Math.min(this.p.maxHp, this.p.hp + 40); this.log("Использовал стимулятор."); }
        this.updateUI();
    }

    toggleCombatUI(on) {
        document.getElementById('btn-atk').disabled = !on;
        document.getElementById('btn-dead').disabled = !on;
        document.getElementById('btn-explore').disabled = on;
    }

    // --- РЕНДЕР (ЧАСТЬ 3) ---
    drawSprite(m, x, y, size, color) {
        this.ctx.fillStyle = color;
        m.forEach((row, r) => {
            row.forEach((pixel, c) => {
                if(pixel) this.ctx.fillRect(x + c*size, y + r*size, size, size);
            });
        });
    }

    loop() {
        this.ctx.fillStyle = "#000";
        this.ctx.fillRect(0,0,750,550);

        // Тряска
        let ox = 0, oy = 0;
        if(this.shake > 0) { ox = Math.random()*this.shake; oy = Math.random()*this.shake; this.shake *= 0.9; }

        // Рисуем ковбоя
        this.drawSprite(Sprites.Player, 100 + ox, 300 + oy, 8, "#00ff41");

        // Дрон
        if(this.p.drone) {
            let hover = Math.sin(Date.now()/200)*10;
            this.drawSprite(Sprites.MK3, 60, 250 + hover, 6, "#00ccff");
        }

        // Враг
        if(this.enemy) {
            this.drawSprite(Sprites.Bot, 550, 320, 12, "#ff3333");
            // HP Bar
            this.ctx.fillStyle = "#333";
            this.ctx.fillRect(550, 300, 100, 10);
            this.ctx.fillStyle = "#ff3333";
            this.ctx.fillRect(550, 300, (this.enemy.hp/this.enemy.maxHp)*100, 10);
        }

        requestAnimationFrame(() => this.loop());
    }
}

const game = new CyberEngine();
</script>
</body>
</html>
