<!DOCTYPE html>
<html>
<head>
    <title>HACK_DASH_3D // VADIMIVASH</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&display=swap');
        body { margin: 0; background: #050505; overflow: hidden; font-family: 'Fira Code', monospace; }
        
        canvas { display: block; width: 100vw; height: 100vh; }

        /* HUD */
        #ui { position: fixed; top: 20px; left: 20px; color: #fff; background: rgba(0,0,0,0.7); padding: 15px; border-left: 5px solid #0077ff; }
        #map { position: fixed; top: 20px; right: 20px; width: 150px; height: 150px; border: 2px solid #0077ff; background: rgba(0,0,0,0.8); }

        /* Кулаки */
        #hands-container {
            position: fixed; bottom: -20px; left: 50%; transform: translateX(-50%);
            width: 800px; height: 400px; pointer-events: none;
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        .hand {
            width: 250px; height: 350px; background: #1a1a1a;
            border: 6px solid #333; border-radius: 60px 60px 0 0;
            box-shadow: inset 0 20px 50px rgba(0,0,0,0.8), 0 0 30px rgba(0,119,255,0.3);
            transition: 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .punch { transform: translateY(-150px) scale(1.2) !important; background: #0077ff !important; }

        /* Сюжетные окна */
        #overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            display: none; flex-direction: column; align-items: center; justify-content: center;
            color: #fff; text-align: center; z-index: 100;
        }
        input { background: #000; border: 2px solid #0077ff; color: #fff; padding: 10px; font-size: 24px; text-align: center; font-family: inherit; }
        .btn { border: 1px solid #0077ff; background: transparent; color: #0077ff; padding: 15px 30px; cursor: pointer; margin-top: 20px; }
        .btn:hover { background: #0077ff; color: #fff; }
    </style>
</head>
<body>

    <div id="ui">
        <b>ЦЕЛЬ:</b> ИЗВЛЕЧЬ ДЕНЬГИ ($<span id="money">0</span>)<br>
        <b>СТАТУС:</b> СБОР МАСТЕР-КЛЮЧЕЙ...<br>
        <small>W,A,S,D - ХОДИТЬ | ПРОБЕЛ - УДАР</small>
    </div>

    <canvas id="map" width="150" height="150"></canvas>
    <canvas id="game"></canvas>

    <div id="hands-container">
        <div id="h-left" class="hand" style="transform: rotate(-10deg) translateX(30px);"></div>
        <div id="h-right" class="hand" style="transform: rotate(10deg) translateX(-30px);"></div>
    </div>

    <div id="overlay">
        <h1 id="title">SYSTEM_LOCK</h1>
        <p id="msg">ВВЕДИТЕ ПИН-КОД СОСЕДА ДЛЯ ВХОДА:</p>
        <input type="text" id="inp" maxlength="4">
        <button class="btn" onclick="checkCode()">ПОДТВЕРДИТЬ</button>
    </div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const mapCanvas = document.getElementById('map');
    const mctx = mapCanvas.getContext('2d');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let money = 0;
    let gameActive = false;

    // Карта 10x10 (2 - золото)
    const world = [
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,1,2,0,0,0,1],
        [1,0,1,0,1,1,1,1,0,1],
        [1,0,1,0,0,0,0,1,0,1],
        [1,0,1,1,1,1,0,0,0,1],
        [1,0,0,0,0,1,0,1,0,1],
        [1,1,1,1,0,1,0,1,2,1],
        [1,2,0,1,0,0,0,1,0,1],
        [1,0,0,0,0,1,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
    ];

    const player = { x: 1.5, y: 1.5, dir: 0 };
    const keys = {};

    window.onkeydown = (e) => { 
        keys[e.code] = true; 
        if(e.code === 'Space') doPunch();
    };
    window.onkeyup = (e) => keys[e.code] = false;

    let pSide = true;
    function doPunch() {
        const h = document.getElementById(pSide ? 'h-left' : 'h-right');
        h.classList.add('punch');
        setTimeout(() => h.classList.remove('punch'), 100);
        pSide = !pSide;
        
        // Проверка сбора денег ударом
        let tx = Math.floor(player.x + Math.cos(player.dir) * 0.5);
        let ty = Math.floor(player.y + Math.sin(player.dir) * 0.5);
        if(world[ty][tx] === 2) {
            world[ty][tx] = 0;
            money += 50000;
            document.getElementById('money').innerText = money;
            if(money >= 150000) finish();
        }
    }

    // Взлом Банка
    setTimeout(() => {
        document.getElementById('overlay').style.display = 'flex';
    }, 1000);

    function checkCode() {
        const val = document.getElementById('inp').value;
        if(val === "1984") {
            document.getElementById('title').innerText = "ACCESS_GRANTED";
            document.getElementById('msg').innerText = "НАЙДИТЕ И ВЫБЕЙТЕ 3 КРИПТО-КЕЙСА В ЛАБИРИНТЕ!";
            setTimeout(() => {
                document.getElementById('overlay').style.display = 'none';
                gameActive = true;
                loop();
            }, 2000);
        } else {
            alert("WRONG PIN!");
        }
    }

    function render() {
        // Очистка (Пол и Потолок)
        ctx.fillStyle = '#111'; // Потолок
        ctx.fillRect(0,0, canvas.width, canvas.height/2);
        ctx.fillStyle = '#222'; // Пол
        ctx.fillRect(0, canvas.height/2, canvas.width, canvas.height/2);

        const rays = 250;
        const fov = Math.PI / 3;

        for(let i=0; i<rays; i++) {
            let angle = (player.dir - fov/2) + (i/rays) * fov;
            let dist = 0;
            let hit = 0;

            while(dist < 15) {
                dist += 0.05;
                let rx = Math.floor(player.x + Math.cos(angle) * dist);
                let ry = Math.floor(player.y + Math.sin(angle) * dist);
                if(world[ry][rx] > 0) {
                    hit = world[ry][rx];
                    break;
                }
            }

            let realDist = dist * Math.cos(angle - player.dir);
            let h = canvas.height / realDist;
            
            // Цвет: 1 - стена (синяя), 2 - деньги (золотые)
            ctx.fillStyle = hit === 1 ? `rgb(0, ${100 - realDist*5}, ${200 - realDist*10})` : '#ffcc00';
            ctx.fillRect(i * (canvas.width/rays), (canvas.height-h)/2, (canvas.width/rays)+1, h);
        }

        // Мини-карта
        mctx.fillStyle = '#000'; mctx.fillRect(0,0,150,150);
        for(let y=0; y<10; y++) {
            for(let x=0; x<10; x++) {
                if(world[y][x] === 1) mctx.fillStyle = '#0077ff';
                else if(world[y][x] === 2) mctx.fillStyle = '#ffcc00';
                else continue;
                mctx.fillRect(x*15, y*15, 14, 14);
            }
        }
        mctx.fillStyle = '#fff';
        mctx.fillRect(player.x*15-2, player.y*15-2, 4, 4);
    }

    function update() {
        if(!gameActive) return;
        if(keys['KeyA']) player.dir -= 0.05;
        if(keys['KeyD']) player.dir += 0.05;
        let speed = 0;
        if(keys['KeyW']) speed = 0.06;
        if(keys['KeyS']) speed = -0.06;

        let nx = player.x + Math.cos(player.dir) * speed;
        let ny = player.y + Math.sin(player.dir) * speed;
        
        if(world[Math.floor(ny)][Math.floor(nx)] === 0) {
            player.x = nx; player.y = ny;
        }
    }

    function finish() {
        gameActive = false;
        document.getElementById('overlay').style.display = 'flex';
        document.getElementById('title').innerText = "ВЫ БОГАТЫ!";
        document.getElementById('msg').innerText = `ВЫ УКРАЛИ $${money}. СОСЕД В ШОКЕ.`;
        document.getElementById('inp').style.display = 'none';
    }

    function loop() {
        update();
        render();
        if(gameActive) requestAnimationFrame(loop);
    }
</script>
</body>
</html>
