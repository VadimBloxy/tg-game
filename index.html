<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>CYBER WESTERN: PIXEL ENGINE</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

        body {
            margin: 0;
            background-color: #050505;
            color: #00ff41;
            font-family: 'Press Start 2P', monospace; /* –ü–∏–∫—Å–µ–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
            user-select: none;
        }

        #game-wrapper {
            position: relative;
            width: 1024px;
            height: 768px;
            border: 4px solid #333;
            box-shadow: 0 0 60px rgba(0, 255, 65, 0.15);
            background: #000;
            display: grid;
            grid-template-rows: 60px 1fr 200px;
        }

        /* --- UI: HEADER --- */
        header {
            background: #111;
            border-bottom: 3px solid #00ff41;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 30px;
            font-size: 16px;
            color: #fff;
            text-shadow: 2px 2px 0 #000;
        }
        
        .stat-box span { color: #00ff41; }
        .stat-box.danger span { color: #ff0000; }

        /* --- UI: MAIN CANVAS AREA --- */
        #viewport {
            position: relative;
            background: #000;
            display: flex;
        }

        canvas {
            background: radial-gradient(circle at center, #1a2a1a 0%, #000000 100%);
            image-rendering: pixelated; /* –ß–µ—Ç–∫–∏–µ –ø–∏–∫—Å–µ–ª–∏ */
            width: 724px;
            height: 100%;
        }

        /* --- UI: SIDEBAR (INVENTORY) --- */
        #sidebar {
            width: 300px;
            background: #080808;
            border-left: 3px solid #333;
            padding: 15px;
            overflow-y: auto;
            font-size: 12px;
            color: #aaa;
        }
        
        #sidebar h3 { color: #ffcc00; border-bottom: 2px dashed #ffcc00; padding-bottom: 5px; margin-top: 20px; }
        .inv-item { display: flex; justify-content: space-between; margin-bottom: 8px; border-bottom: 1px solid #222; padding-bottom: 2px; }
        .btn-mini { background: #400; color: #fff; border: 1px solid #f00; cursor: pointer; font-size: 10px; font-family: inherit; }
        .btn-mini:hover { background: #f00; }

        /* --- UI: BOTTOM LOG & CONTROLS --- */
        #bottom-panel {
            border-top: 3px solid #00ff41;
            background: #000;
            display: grid;
            grid-template-columns: 1fr 350px;
        }

        #log {
            padding: 15px;
            overflow-y: scroll;
            font-size: 12px;
            line-height: 1.6;
            border-right: 2px solid #333;
        }
        #log p { margin: 0; }
        .l-green { color: #00ff41; }
        .l-red { color: #ff3333; }
        .l-gold { color: #ffcc00; }
        .l-blue { color: #00ccff; }

        #controls {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #111;
        }

        .btn-big {
            width: 90%;
            padding: 15px;
            font-family: 'Press Start 2P', monospace;
            font-size: 14px;
            background: #000;
            color: #00ff41;
            border: 2px solid #00ff41;
            cursor: pointer;
            transition: 0.1s;
            text-shadow: 0 0 5px #00ff41;
        }
        .btn-big:hover { background: #00ff41; color: #000; }
        .btn-big:disabled { border-color: #444; color: #444; cursor: not-allowed; text-shadow: none; background: #000; }
        
        /* –°–∫—Ä—ã—Ç—ã–π —ç–∫—Ä–∞–Ω –∫–æ–Ω—Ü–æ–≤–∫–∏ */
        #end-screen {
            display: none;
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 999;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        #end-screen h1 { font-size: 40px; color: #00ff41; margin-bottom: 20px; }
    </style>
</head>
<body>

<div id="game-wrapper">
    <header>
        <div class="stat-box">LVL: <span id="ui-lvl">1</span></div>
        <div class="stat-box">HP: <span id="ui-hp">100</span>/<span id="ui-maxhp">100</span></div>
        <div class="stat-box">SP: <span id="ui-sp">100</span></div>
        <div class="stat-box">$$$: <span id="ui-money">50</span></div>
        <div class="stat-box">SCRAP: <span id="ui-parts">0</span></div>
    </header>

    <div id="viewport">
        <canvas id="gameCanvas" width="724" height="508"></canvas>
        <aside id="sidebar">
            <h3>ACTIVE GEAR</h3>
            <div id="drone-display" style="color:#00ccff; margin-bottom:10px;">NO DRONE</div>
            
            <h3>INVENTORY</h3>
            <div id="inv-list"></div>

            <h3>CRAFTING</h3>
            <button class="btn-mini" style="width:100%; padding:5px; background:#222; border-color:#ffcc00; color:#ffcc00;" onclick="game.craft('drone')">CRAFT DRONE (10 SCRAP)</button>
            <br><br>
            <button class="btn-mini" style="width:100%; padding:5px; background:#222; border-color:#00ff41; color:#fff;" onclick="game.craft('heal')">CRAFT STIM (2 SCRAP)</button>
        </aside>
    </div>

    <div id="bottom-panel">
        <div id="log">
            <p class="l-green">> SYSTEM BOOT...</p>
            <p class="l-green">> WELCOME TO THE WASTELAND.</p>
        </div>
        <div id="controls">
            <button id="btn-explore" class="btn-big" onclick="game.explore()">EXPLORE SECTOR</button>
            <button id="btn-attack" class="btn-big" onclick="game.combatTurn()" disabled>FIRE WEAPON</button>
            <button id="btn-heal" class="btn-big" onclick="game.useItem('heal')">HEAL (2)</button>
        </div>
    </div>
    
    <div id="end-screen">
        <h1>SYSTEM REBOOT</h1>
        <p style="color:#fff; max-width:600px; line-height:20px;">
            –ê—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä —É–Ω–∏—á—Ç–æ–∂–µ–Ω. –¶–∏–∫–ª –ø—Ä–µ—Ä–≤–∞–Ω.<br>–í—ã –æ—Å–≤–æ–±–æ–¥–∏–ª–∏—Å—å –∏–∑ —Å–∏–º—É–ª—è—Ü–∏–∏.
        </p>
        <br>
        <button class="btn-big" onclick="location.reload()">RESTART SYSTEM</button>
    </div>
</div>

<script>
/**
 * CYBER WESTERN ENGINE v1.0
 * Canvas Rendering, Sprite System, Particle System, Game Logic
 */

// --- 1. PIXEL ART MODELS (Bitmaps 0/1) ---
// 1 = –ü–∏–∫—Å–µ–ª—å, 0 = –ü—É—Å—Ç–æ—Ç–∞
const Sprites = {
    player: [
        [0,0,0,1,1,1,1,1,0,0,0], // –®–ª—è–ø–∞
        [0,0,1,1,1,1,1,1,1,0,0],
        [0,0,1,1,1,1,1,1,1,0,0],
        [0,0,0,0,1,1,1,0,0,0,0], // –ì–æ–ª–æ–≤–∞
        [0,0,0,1,1,0,1,1,0,0,0], // –ì–ª–∞–∑–∞ (–æ—á–∫–∏)
        [0,0,0,1,1,1,1,1,0,0,0],
        [0,0,1,1,1,1,1,1,1,0,0], // –ü–ª–∞—â
        [0,1,1,1,1,1,1,1,1,1,0],
        [1,1,0,1,1,1,1,1,0,1,1], // –†—É–∫–∏/–û—Ä—É–∂–∏–µ
        [1,0,0,1,1,1,1,1,0,0,1],
        [0,0,0,1,0,0,0,1,0,0,0], // –ù–æ–≥–∏
        [0,0,1,1,0,0,0,1,1,0,0]
    ],
    drone: [
        [0,0,1,1,1,1,1,0,0],
        [0,1,1,0,0,0,1,1,0],
        [1,1,0,1,0,1,0,1,1],
        [1,1,1,1,1,1,1,1,1], // –¢–µ–ª–æ
        [0,0,1,0,1,0,1,0,0],
        [0,0,0,1,1,1,0,0,0]
    ],
    enemy_scout: [
        [0,0,0,0,1,0,0,0,0],
        [0,0,1,1,1,1,1,0,0],
        [0,1,1,1,1,1,1,1,0], // –ü—Ç–∏—Ü–∞
        [1,1,0,1,1,1,0,1,1],
        [0,0,0,1,1,1,0,0,0],
        [0,0,1,0,0,0,1,0,0]
    ],
    enemy_robot: [
        [0,0,1,1,1,1,0,0],
        [0,1,1,1,1,1,1,0],
        [0,1,0,1,1,0,1,0], // –†–æ–±–æ—Ç
        [1,1,1,1,1,1,1,1],
        [1,0,1,1,1,1,0,1],
        [0,0,1,0,0,1,0,0],
        [0,1,1,0,0,1,1,0]
    ],
    boss: [
        [0,0,1,1,1,1,1,1,0,0],
        [0,1,1,1,1,1,1,1,1,0],
        [1,1,0,1,0,0,1,0,1,1], // –ì–õ–ê–ó–ê
        [1,1,1,1,1,1,1,1,1,1],
        [1,1,1,0,1,1,0,1,1,1], // –†–û–¢
        [0,1,1,1,1,1,1,1,1,0],
        [0,0,1,0,0,0,0,1,0,0],
        [0,1,1,0,0,0,0,1,1,0]
    ]
};

// --- 2. RENDER ENGINE ---

class Renderer {
    constructor(canvasId) {
        this.canvas = document.getElementById(canvasId);
        this.ctx = this.canvas.getContext('2d');
        this.particles = [];
        this.shake = 0;
        this.flash = 0;
    }

    // –†–∏—Å—É–µ–º —Å–ø—Ä–∞–π—Ç –∏–∑ –º–∞—Ç—Ä–∏—Ü—ã 0/1
    drawSprite(matrix, x, y, size, color) {
        this.ctx.fillStyle = color;
        for (let r = 0; r < matrix.length; r++) {
            for (let c = 0; c < matrix[r].length; c++) {
                if (matrix[r][c] === 1) {
                    this.ctx.fillRect(x + c * size, y + r * size, size, size);
                }
            }
        }
    }

    // –≠—Ñ—Ñ–µ–∫—Ç —Ç—Ä—è—Å–∫–∏ —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏ —É–¥–∞—Ä–µ
    triggerShake(amount) {
        this.shake = amount;
    }
    
    // –≠—Ñ—Ñ–µ–∫—Ç –≤—Å–ø—ã—à–∫–∏ (–≤—ã—Å—Ç—Ä–µ–ª)
    triggerFlash() {
        this.flash = 5;
    }

    addParticle(x, y, color) {
        this.particles.push({
            x: x, y: y, 
            vx: (Math.random() - 0.5) * 10, 
            vy: (Math.random() - 0.5) * 10, 
            life: 20, 
            color: color
        });
    }

    clear() {
        this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
        
        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Ç—Ä—è—Å–∫–∏
        let dx = (Math.random() - 0.5) * this.shake;
        let dy = (Math.random() - 0.5) * this.shake;
        if(this.shake > 0) this.shake *= 0.9;
        if(this.shake < 0.5) this.shake = 0;
        
        this.ctx.save();
        this.ctx.translate(dx, dy);
    }

    renderScene(state, player, enemy) {
        this.clear();

        // 1. –ó–µ–º–ª—è (–°–µ—Ç–∫–∞)
        this.ctx.strokeStyle = "#003300";
        this.ctx.lineWidth = 2;
        this.ctx.beginPath();
        for(let i=0; i<this.canvas.width; i+=40) {
            this.ctx.moveTo(i, 300); this.ctx.lineTo(i-200, 600);
        }
        this.ctx.moveTo(0, 400); this.ctx.lineTo(800, 400);
        this.ctx.stroke();

        // 2. –ò–≥—Ä–æ–∫
        const pColor = player.shieldActive > 0 ? "#00ffff" : "#00ff41";
        this.drawSprite(Sprites.player, 100, 300, 12, pColor);
        
        // 3. –î—Ä–æ–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
        if (player.drone) {
            let floatY = Math.sin(Date.now() / 200) * 10;
            this.drawSprite(Sprites.drone, 50, 280 + floatY, 8, "#00ccff");
        }

        // 4. –í—Ä–∞–≥ (–µ—Å–ª–∏ –µ—Å—Ç—å)
        if (state === 'COMBAT' && enemy) {
            let eColor = enemy.isBoss ? "#ff0000" : "#ffaa00";
            let scale = enemy.isBoss ? 20 : 12;
            let sprite = enemy.isBoss ? Sprites.boss : (enemy.type === 'fly' ? Sprites.enemy_scout : Sprites.enemy_robot);
            
            // –ê–Ω–∏–º–∞—Ü–∏—è –¥—ã—Ö–∞–Ω–∏—è
            let breath = Math.sin(Date.now() / 300) * 5;
            this.drawSprite(sprite, 500, 300 + breath, scale, eColor);
            
            // HP Bar –≤—Ä–∞–≥–∞ –Ω–∞–¥ –≥–æ–ª–æ–≤–æ–π
            this.ctx.fillStyle = "#330000";
            this.ctx.fillRect(500, 280, 100, 10);
            this.ctx.fillStyle = "#ff0000";
            this.ctx.fillRect(500, 280, (enemy.hp / enemy.maxHp) * 100, 10);
        }

        // 5. –ß–∞—Å—Ç–∏—Ü—ã
        for (let i = this.particles.length - 1; i >= 0; i--) {
            let p = this.particles[i];
            p.x += p.vx; p.y += p.vy; p.life--;
            this.ctx.fillStyle = p.color;
            this.ctx.fillRect(p.x, p.y, 4, 4);
            if (p.life <= 0) this.particles.splice(i, 1);
        }
        
        // 6. –í—Å–ø—ã—à–∫–∞
        if (this.flash > 0) {
            this.ctx.fillStyle = `rgba(255, 255, 255, ${this.flash * 0.1})`;
            this.ctx.fillRect(0,0, 1000, 1000);
            this.flash--;
        }

        this.ctx.restore();
    }
}

// --- 3. GAME LOGIC ---

class Game {
    constructor() {
        this.renderer = new Renderer('gameCanvas');
        this.state = 'IDLE'; // IDLE, COMBAT, END
        
        this.player = {
            hp: 100, maxHp: 100, sp: 100,
            money: 50, parts: 0, lvl: 1, xp: 0,
            minDmg: 10, maxDmg: 20,
            inventory: [],
            supplies: { heal: 2 },
            drone: null, // { dmg: 10, name: "MK1" }
            shieldActive: 0
        };

        this.currentEnemy = null;
        this.bossCounter = 0;
        
        this.startLoop();
    }

    // –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∞–Ω–∏–º–∞—Ü–∏–∏
    startLoop() {
        const loop = () => {
            this.renderer.renderScene(this.state, this.player, this.currentEnemy);
            requestAnimationFrame(loop);
        };
        loop();
    }

    log(msg, type = "l-green") {
        const logEl = document.getElementById('log');
        logEl.innerHTML += `<p class="${type}">> ${msg}</p>`;
        logEl.scrollTop = logEl.scrollHeight;
    }

    updateUI() {
        document.getElementById('ui-lvl').innerText = this.player.lvl;
        document.getElementById('ui-hp').innerText = this.player.hp;
        document.getElementById('ui-maxhp').innerText = this.player.maxHp;
        document.getElementById('ui-sp').innerText = this.player.sp;
        document.getElementById('ui-money').innerText = this.player.money;
        document.getElementById('ui-parts').innerText = this.player.parts;
        document.getElementById('btn-heal').innerText = `HEAL (${this.player.supplies.heal})`;
        
        if (this.player.drone) {
            document.getElementById('drone-display').innerText = `ACTIVE: ${this.player.drone.name}`;
        }

        // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
        const list = document.getElementById('inv-list');
        list.innerHTML = "";
        this.player.inventory.forEach((item, idx) => {
            list.innerHTML += `
                <div class="inv-item">
                    <span>${item.name}</span>
                    <button class="btn-mini" onclick="game.scrapItem(${idx})">SCRAP</button>
                </div>`;
        });
    }

    // --- GAMEPLAY ACTIONS ---

    explore() {
        if (this.state === 'COMBAT') return;

        // –§–∏–Ω–∞–ª—å–Ω—ã–π –±–æ—Å—Å –Ω–∞ 10 —É—Ä–æ–≤–Ω–µ
        if (this.player.lvl >= 10) {
            this.spawnEnemy(true, true); // True Boss
            return;
        }

        this.renderer.triggerFlash();
        
        if (Math.random() > 0.6 || this.bossCounter >= 5) {
            this.spawnEnemy(this.bossCounter >= 5);
        } else {
            const found = Math.floor(Math.random() * 30) + 10;
            this.player.money += found;
            this.log(`–ù–∞–π–¥–µ–Ω —Ç–∞–π–Ω–∏–∫: +${found} –∫—Ä–µ–¥–∏—Ç–æ–≤.`, "l-gold");
            this.updateUI();
        }
    }

    spawnEnemy(isBoss, isFinal = false) {
        this.state = 'COMBAT';
        if (isBoss) this.bossCounter = 0;
        
        const type = Math.random() > 0.5 ? 'fly' : 'ground';
        let hp = 30 + (this.player.lvl * 15);
        let dmg = 8 + (this.player.lvl * 2);
        let name = "Scrap Bot";

        if (isBoss) {
            hp *= 3; dmg *= 1.5; name = "SECTOR BOSS";
            this.log("‚ö†Ô∏è –û–ë–ù–ê–†–£–ñ–ï–ù –ë–û–°–° –°–ï–ö–¢–û–†–ê!", "l-red");
        } else if (isFinal) {
            hp = 2000; dmg = 50; name = "THE ARCHITECT";
            this.log("üõë –°–ò–°–¢–ï–ú–ù–ê–Ø –û–®–ò–ë–ö–ê: –ê–†–•–ò–¢–ï–ö–¢–û–† –ó–î–ï–°–¨.", "l-red");
        } else {
            this.log(`–í—Ä–∞–≥ –æ–±–Ω–∞—Ä—É–∂–µ–Ω: ${name}`, "l-red");
        }

        this.currentEnemy = { 
            name, hp, maxHp: hp, damage: dmg, 
            type, isBoss, isFinal 
        };

        document.getElementById('btn-explore').disabled = true;
        document.getElementById('btn-attack').disabled = false;
        this.updateUI();
    }

    combatTurn() {
        if (!this.currentEnemy) return;

        // 1. –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞
        this.renderer.triggerFlash();
        this.renderer.triggerShake(5);
        
        // –í–∏–∑—É–∞–ª—å–Ω—ã–π —ç—Ñ—Ñ–µ–∫—Ç –≤—ã—Å—Ç—Ä–µ–ª–∞ (—á–∞—Å—Ç–∏—Ü—ã –Ω–∞ –≤—Ä–∞–≥–µ)
        for(let i=0; i<10; i++) this.renderer.addParticle(550, 350, "#ffaa00");

        let dmg = Math.floor(Math.random() * (this.player.maxDmg - this.player.minDmg)) + this.player.minDmg;
        
        // –ö—Ä–∏—Ç
        if (Math.random() < 0.15) { dmg *= 2; this.log("–ö–†–ò–¢–ò–ß–ï–°–ö–ò–ô –£–†–û–ù!", "l-gold"); }
        
        this.currentEnemy.hp -= dmg;
        this.log(`–í—ã –Ω–∞–Ω–µ—Å–ª–∏ ${dmg} —É—Ä–æ–Ω–∞.`);

        // 2. –ê—Ç–∞–∫–∞ –¥—Ä–æ–Ω–∞
        if (this.player.drone) {
            this.currentEnemy.hp -= this.player.drone.dmg;
            this.log(`–î—Ä–æ–Ω —Å—Ç—Ä–µ–ª—è–µ—Ç: ${this.player.drone.dmg} —É—Ä–æ–Ω–∞.`, "l-blue");
            // –õ–∞–∑–µ—Ä –¥—Ä–æ–Ω–∞
            this.renderer.ctx.beginPath();
            this.renderer.ctx.moveTo(80, 280);
            this.renderer.ctx.lineTo(550, 350);
            this.renderer.ctx.strokeStyle = "#00ccff";
            this.renderer.ctx.stroke();
        }

        // 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–º–µ—Ä—Ç–∏ –≤—Ä–∞–≥–∞
        if (this.currentEnemy.hp <= 0) {
            this.winCombat();
            return;
        }

        // 4. –û—Ç–≤–µ—Ç –≤—Ä–∞–≥–∞ (–∑–∞–¥–µ—Ä–∂–∫–∞)
        document.getElementById('btn-attack').disabled = true;
        setTimeout(() => {
            if (!this.currentEnemy) return;
            
            // –£–¥–∞—Ä –ø–æ –∏–≥—Ä–æ–∫—É
            this.renderer.triggerShake(10);
            for(let i=0; i<10; i++) this.renderer.addParticle(100, 350, "#ff0000"); // –ö—Ä–æ–≤—å/–ò—Å–∫—Ä—ã

            let eDmg = Math.floor(Math.random() * this.currentEnemy.damage);
            if (this.player.shieldActive > 0) {
                eDmg = Math.floor(eDmg / 2);
                this.player.shieldActive--;
                this.log("–©–∏—Ç –ø–æ–≥–ª–æ—Ç–∏–ª —á–∞—Å—Ç—å —É—Ä–æ–Ω–∞!", "l-blue");
            }

            this.player.hp -= eDmg;
            this.log(`${this.currentEnemy.name} –∞—Ç–∞–∫—É–µ—Ç: -${eDmg} HP`, "l-red");

            if (this.player.hp <= 0) {
                alert("SYSTEM FAILURE. GAME OVER.");
                location.reload();
            }

            document.getElementById('btn-attack').disabled = false;
            this.updateUI();
        }, 600);
        
        this.updateUI();
    }

    winCombat() {
        if (this.currentEnemy.isFinal) {
            document.getElementById('end-screen').style.display = 'flex';
            return;
        }

        this.renderer.addParticle(550, 350, "#ffffff"); // –í–∑—Ä—ã–≤ –≤—Ä–∞–≥–∞
        
        let loot = this.currentEnemy.isBoss ? 200 : 40;
        let xp = this.currentEnemy.isBoss ? 100 : 25;
        
        this.player.money += loot;
        this.player.xp += xp;
        
        // –®–∞–Ω—Å –¥—Ä–æ–ø–∞ –ø—Ä–µ–¥–º–µ—Ç–∞
        if (Math.random() > 0.5) {
            const items = [
                { name: "Old Chip", scrap: 2 },
                { name: "Rusty Plate", scrap: 3 },
                { name: "Cyber Eye", scrap: 5 }
            ];
            let item = items[Math.floor(Math.random() * items.length)];
            this.player.inventory.push(item);
            this.log(`–ü–æ–ª—É—á–µ–Ω –ø—Ä–µ–¥–º–µ—Ç: ${item.name}`, "l-gold");
        }

        // Level Up
        if (this.player.xp >= 100) {
            this.player.lvl++;
            this.player.xp = 0;
            this.player.maxHp += 20;
            this.player.hp = this.player.maxHp;
            this.player.minDmg += 5;
            this.player.maxDmg += 5;
            this.log(`LEVEL UP! –¢–µ–ø–µ—Ä—å —É—Ä–æ–≤–µ–Ω—å ${this.player.lvl}`, "l-blue");
        }

        this.currentEnemy = null;
        this.state = 'IDLE';
        if (!this.currentEnemy?.isBoss) this.bossCounter++;
        
        document.getElementById('btn-explore').disabled = false;
        document.getElementById('btn-attack').disabled = true;
        this.log("–¶–µ–ª—å —É–Ω–∏—á—Ç–æ–∂–µ–Ω–∞.", "l-green");
        this.updateUI();
    }

    // --- CRAFTING & ITEMS ---

    scrapItem(index) {
        let item = this.player.inventory[index];
        this.player.parts += item.scrap;
        this.player.inventory.splice(index, 1);
        this.log(`–†–∞–∑–æ–±—Ä–∞–Ω–æ: ${item.name} (+${item.scrap} scrap)`);
        this.updateUI();
    }

    craft(type) {
        if (type === 'drone') {
            if (this.player.parts >= 10) {
                this.player.parts -= 10;
                this.player.drone = { name: "HK-47", dmg: 15 };
                this.log("–°–æ–±—Ä–∞–Ω –±–æ–µ–≤–æ–π –¥—Ä–æ–Ω HK-47!", "l-blue");
            } else {
                this.log("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ—Ç–∞–ª–µ–π (–ù—É–∂–Ω–æ 10)", "l-red");
            }
        }
        if (type === 'heal') {
            if (this.player.parts >= 2) {
                this.player.parts -= 2;
                this.player.supplies.heal++;
                this.log("–°–∫—Ä–∞—Ñ—á–µ–Ω–∞ –∞–ø—Ç–µ—á–∫–∞.", "l-green");
            } else {
                this.log("–ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–µ—Ç–∞–ª–µ–π (–ù—É–∂–Ω–æ 2)", "l-red");
            }
        }
        this.updateUI();
    }

    useItem(type) {
        if (type === 'heal') {
            if (this.player.supplies.heal > 0) {
                this.player.supplies.heal--;
                this.player.hp = Math.min(this.player.maxHp, this.player.hp + 50);
                this.log("–°–∏—Å—Ç–µ–º—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã (+50 HP)", "l-green");
                this.renderer.flash = 3; // –ó–µ–ª–µ–Ω–∞—è –≤—Å–ø—ã—à–∫–∞ (—É—Å–ª–æ–≤–Ω–æ)
            } else {
                this.log("–ù–µ—Ç –∞–ø—Ç–µ—á–µ–∫!", "l-red");
            }
        }
        this.updateUI();
    }
}

// –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
const game = new Game();

</script>
</body>
</html>
