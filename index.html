<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neon TD: Evolution - Part 2</title>
    <style>
        :root {
            --bg: #0a0a12;
            --panel: #16213e;
            --accent: #e94560;
            --gold: #fbc531;
            --green: #4ecca3;
            --cell: #1a1a2e; /* –ù–æ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –∫–ª–µ—Ç–æ–∫ */
        }

        body {
            margin: 0;
            padding: 0;
            background: var(--bg);
            color: white;
            font-family: 'Segoe UI', Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        #game-container {
            width: 900px;
            height: 600px;
            background: var(--panel);
            border: 3px solid #0f3460;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
            border-radius: 10px;
        }

        /* –≠–∫—Ä–∞–Ω—ã */
        .screen {
            display: none;
            width: 100%;
            height: 100%;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: absolute;
        }

        .active { display: flex; }

        /* –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å */
        h1 { font-size: 4rem; margin: 0 0 10px 0; color: var(--accent); text-shadow: 3px 3px 0px #533483; letter-spacing: 5px; }
        
        .stats-bar {
            position: absolute;
            top: 20px;
            right: 30px;
            font-size: 1.5rem;
            color: var(--gold);
            font-weight: bold;
            z-index: 10;
            background: rgba(0,0,0,0.3);
            padding: 5px 15px;
            border-radius: 20px;
        }

        .btn {
            background: #0f3460;
            color: white;
            border: 2px solid var(--accent);
            padding: 15px 50px;
            margin: 10px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: 0.2s;
            text-transform: uppercase;
            border-radius: 5px;
            width: 250px;
        }

        .btn:hover {
            background: var(--accent);
            box-shadow: 0 0 15px var(--accent);
            transform: scale(1.05);
        }

        /* –ú–∞–≥–∞–∑–∏–Ω –∏ –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å */
        .grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            width: 90%;
            max-height: 400px;
            overflow-y: auto;
            padding: 10px;
        }

        .card {
            background: #1a1a2e;
            border: 2px solid #0f3460;
            padding: 20px;
            border-radius: 10px;
            transition: 0.3s;
        }

        .card:hover { border-color: var(--green); }
        .card h3 { margin-top: 0; color: var(--green); }
        .price { color: var(--gold); font-size: 1.2rem; margin-bottom: 15px; }

        /* –ò–ì–†–û–í–û–ï –ü–û–õ–ï (–ù–æ–≤–æ–µ) */
        #map {
            display: grid;
            grid-template-columns: repeat(12, 50px);
            grid-template-rows: repeat(8, 50px);
            gap: 2px;
            background: #0f3460;
            padding: 5px;
            border: 2px solid var(--accent);
        }

        .cell {
            width: 50px; height: 50px; background: var(--cell);
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; font-size: 0.6rem; text-align: center; color: #555;
        }
        .cell:hover { background: #232344; }
        .cell.path { background: #2e2e4d; color: var(--gold); cursor: default; } /* –î–æ—Ä–æ–≥–∞ */
        .cell.tower-placed { background: var(--green); color: black; font-weight: bold; font-size: 0.8rem; }

        /* –°–µ–ª–µ–∫—Ç–æ—Ä –±–∞—à–µ–Ω –≤ –±–æ—é */
        #battle-ui {
            margin-top: 15px;
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(0,0,0,0.4);
            padding: 10px;
            border-radius: 10px;
        }

        .tower-option {
            padding: 8px 15px;
            border: 1px solid var(--green);
            cursor: pointer;
            font-size: 0.9rem;
            border-radius: 4px;
        }

        .tower-option.selected {
            background: var(--green);
            color: black;
            box-shadow: 0 0 10px var(--green);
        }

        /* –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ */
        #loot-anim {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            width: 100%;
            height: 100%;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
    </style>
</head>
<body>

<div id="game-container">
    <div class="stats-bar">üí∞ <span id="coins">1000</span></div>

    <div id="menu" class="screen active">
        <h1>NEON TD</h1>
        <button class="btn" onclick="goTo('play')">–í –ë–û–ô</button>
        <button class="btn" onclick="goTo('inventory')">–ò–ù–í–ï–ù–¢–ê–†–¨</button>
        <button class="btn" onclick="goTo('shop')">–ú–ê–ì–ê–ó–ò–ù</button>
    </div>

    <div id="shop" class="screen">
        <h2>–°–ï–ö–†–ï–¢–ù–´–ï –ö–ï–ô–°–´</h2>
        <div class="grid">
            <div class="card">
                <h3>–î–µ—Ä–µ–≤—è–Ω–Ω—ã–π —è—â–∏–∫</h3>
                <div class="price">100 üí∞</div>
                <button class="btn" style="width:100%; padding:10px;" onclick="buyBox('Wood', 100)">–û–¢–ö–†–´–¢–¨</button>
            </div>
            <div class="card">
                <h3>–°—Ç–∞–ª—å–Ω–æ–π —Å–µ–π—Ñ</h3>
                <div class="price">300 üí∞</div>
                <button class="btn" style="width:100%; padding:10px;" onclick="buyBox('Steel', 300)">–û–¢–ö–†–´–¢–¨</button>
            </div>
            <div class="card" style="border-color: var(--gold);">
                <h3>–ö–≤–∞–Ω—Ç–æ–≤—ã–π –±–æ–∫—Å</h3>
                <div class="price">750 üí∞</div>
                <button class="btn" style="width:100%; padding:10px;" onclick="buyBox('Quantum', 750)">–û–¢–ö–†–´–¢–¨</button>
            </div>
        </div>
        <button class="btn" onclick="goTo('menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="inventory" class="screen">
        <h2>–í–ê–® –ê–†–°–ï–ù–ê–õ</h2>
        <div id="inv-list" class="grid"></div>
        <button class="btn" onclick="goTo('menu')">–ù–ê–ó–ê–î</button>
    </div>

    <div id="play" class="screen">
        <div id="map"></div>
        
        <div id="battle-ui">
            <span>–í—ã–±—Ä–∞—Ç—å –±–∞—à–Ω—é:</span>
            <div id="tower-select-list" style="display: flex; gap: 10px;"></div>
        </div>

        <button class="btn" onclick="goTo('menu')" style="margin-top:10px; padding: 5px 20px; width: auto;">–í –ú–ï–ù–Æ</button>
    </div>

    <div id="loot-anim">
        <h2 id="loot-status" style="color: var(--gold);">–û–¢–ö–†–´–¢–ò–ï...</h2>
        <h1 id="loot-name">???</h1>
        <button class="btn" onclick="closeLoot()">–ó–ê–ë–†–ê–¢–¨</button>
    </div>
</div>

<script>
    let gameState = {
        coins: 1000,
        inventory: ["–ü—É–ª–µ–º–µ—Ç—á–∏–∫"], // –î–∞–µ–º –æ–¥–Ω—É –Ω–∞ —Å—Ç–∞—Ä—Ç
        selectedTower: null
    };

    const towerPool = {
        'Wood': ['–ü—É–ª–µ–º–µ—Ç—á–∏–∫', '–õ—É—á–Ω–∏–∫'],
        'Steel': ['–°–Ω–∞–π–ø–µ—Ä', '–û–≥–Ω–µ–º–µ—Ç'],
        'Quantum': ['–õ–∞–∑–µ—Ä', '–¢–µ—Å–ª–∞-–≤—ã—à–∫–∞']
    };

    // –ü–£–¢–¨ –í–†–ê–ì–ê (–∏–Ω–¥–µ–∫—Å—ã –∫–ª–µ—Ç–æ–∫)
    const enemyPath = [12,13,14,26,38,50,51,52,40,28,16,17,18,19,31,43,55,67,68,69];

    function createMap() {
        const mapDiv = document.getElementById('map');
        mapDiv.innerHTML = '';
        for (let i = 0; i < 96; i++) { // 12x8 = 96 –∫–ª–µ—Ç–æ–∫
            const cell = document.createElement('div');
            cell.className = 'cell';
            cell.id = `c-${i}`;
            
            if (enemyPath.includes(i)) {
                cell.classList.add('path');
                cell.innerText = '‚Ä¢';
            } else {
                cell.onclick = () => placeTower(i);
            }
            mapDiv.appendChild(cell);
        }
    }

    function updateBattleUI() {
        const list = document.getElementById('tower-select-list');
        list.innerHTML = '';
        
        // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –±–∞—à–Ω–∏ –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        const uniqueTowers = [...new Set(gameState.inventory)];
        
        uniqueTowers.forEach(tName => {
            const count = gameState.inventory.filter(x => x === tName).length;
            const opt = document.createElement('div');
            opt.className = 'tower-option' + (gameState.selectedTower === tName ? ' selected' : '');
            opt.innerText = `${tName} (x${count})`;
            opt.onclick = () => {
                gameState.selectedTower = tName;
                updateBattleUI();
            };
            list.appendChild(opt);
        });

        if(uniqueTowers.length === 0) list.innerHTML = '<small>–ù–µ—Ç –±–∞—à–µ–Ω –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–µ!</small>';
    }

    function placeTower(index) {
        if (!gameState.selectedTower) {
            alert("–í—ã–±–µ—Ä–∏—Ç–µ –±–∞—à–Ω—é –≤ –ø–∞–Ω–µ–ª–∏ –≤–Ω–∏–∑—É!");
            return;
        }

        const cell = document.getElementById(`c-${index}`);
        if (cell.classList.contains('tower-placed')) return;

        // –°—Ç–∞–≤–∏–º –±–∞—à–Ω—é
        cell.classList.add('tower-placed');
        cell.innerText = gameState.selectedTower;

        // –£–¥–∞–ª—è–µ–º –æ–¥–Ω—É —à—Ç—É–∫—É –∏–∑ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è
        const itemIdx = gameState.inventory.indexOf(gameState.selectedTower);
        gameState.inventory.splice(itemIdx, 1);
        
        gameState.selectedTower = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
        updateBattleUI();
    }

    function goTo(screenId) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        document.getElementById(screenId).classList.add('active');

        if(screenId === 'inventory') renderInventory();
        if(screenId === 'play') {
            createMap();
            updateBattleUI();
        }
    }

    function buyBox(type, price) {
        if (gameState.coins >= price) {
            gameState.coins -= price;
            updateUI();
            openBox(type);
        } else {
            alert("–ú–∞–ª–æ–≤–∞—Ç–æ –∑–æ–ª–æ—Ç–∏—à–∫–∞!");
        }
    }

    function openBox(type) {
        const items = towerPool[type];
        const winItem = items[Math.floor(Math.random() * items.length)];
        const animScreen = document.getElementById('loot-anim');
        const nameText = document.getElementById('loot-name');
        
        animScreen.style.display = 'flex';
        nameText.innerText = '???';
        
        setTimeout(() => {
            nameText.innerText = winItem;
            gameState.inventory.push(winItem);
        }, 800);
    }

    function closeLoot() {
        document.getElementById('loot-anim').style.display = 'none';
    }

    function renderInventory() {
        const list = document.getElementById('inv-list');
        list.innerHTML = '';
        if(gameState.inventory.length === 0) {
            list.innerHTML = '<p style="grid-column: 1/4">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –±–∞—à–µ–Ω. –ö—É–ø–∏—Ç–µ –∏—Ö –≤ –º–∞–≥–∞–∑–∏–Ω–µ!</p>';
            return;
        }
        gameState.inventory.forEach(item => {
            const card = document.createElement('div');
            card.className = 'card';
            card.innerHTML = `<h3>${item}</h3><p>–ì–æ—Ç–æ–≤ –∫ –±–æ—é</p>`;
            list.appendChild(card);
        });
    }

    function updateUI() {
        document.getElementById('coins').innerText = gameState.coins;
    }

    updateUI();
</script>
</body>
</html>
