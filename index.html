<!DOCTYPE html>
<html>
<head>
    <title>3D HACKER STRIKE // VADIMIVASH</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Courier New', monospace; }
        canvas { display: block; width: 100vw; height: 100vh; filter: contrast(1.2) brightness(1.1); }
        
        /* Руки хакера */
        #hud {
            position: fixed; bottom: 0; left: 50%; transform: translateX(-50%);
            width: 600px; height: 300px; pointer-events: none;
            display: flex; justify-content: space-between; align-items: flex-end;
        }
        .hand {
            width: 200px; height: 250px; background: #111;
            border: 4px solid #00ff41; border-radius: 50px 50px 0 0;
            box-shadow: 0 0 20px rgba(0,255,65,0.5);
            transition: transform 0.1s;
        }
        #left-hand { transform: rotate(-10deg) translateY(50px); }
        #right-hand { transform: rotate(10deg) translateY(50px); }

        /* Анимация удара */
        .punch { transform: translateY(-100px) scale(1.1) rotate(0deg) !important; }

        #ui {
            position: fixed; top: 20px; left: 20px; color: #00ff41;
            text-shadow: 0 0 5px #00ff41; font-size: 20px;
        }
    </style>
</head>
<body>

    <div id="ui">SYSTEM_INTRUSION: ACTIVE<br>W,A,S,D - MOVE | SPACE - PUNCH</div>
    
    <canvas id="game"></canvas>

    <div id="hud">
        <div id="left-hand" class="hand"></div>
        <div id="right-hand" class="hand"></div>
    </div>

<script>
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const lHand = document.getElementById('left-hand');
    const rHand = document.getElementById('right-hand');

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    // Карта лабиринта (1 - стена, 0 - пусто)
    const map = [
        [1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,0,1,1,0,1,1,1,0,1],
        [1,0,0,0,0,0,0,1,0,1],
        [1,1,1,0,1,1,0,1,0,1],
        [1,0,0,0,0,1,0,0,0,1],
        [1,0,1,1,1,1,1,1,0,1],
        [1,0,0,0,0,0,0,0,0,1],
        [1,1,1,1,1,1,1,1,1,1],
    ];

    const player = { x: 1.5, y: 1.5, dir: 0, rot: 0, speed: 0 };

    // Управление
    const keys = {};
    window.onkeydown = (e) => keys[e.code] = true;
    window.onkeyup = (e) => keys[e.code] = false;

    window.onmousedown = () => punch();
    window.onkeydown = (e) => {
        keys[e.code] = true;
        if(e.code === 'Space') punch();
    };

    let punchSide = true;
    function punch() {
        const hand = punchSide ? lHand : rHand;
        hand.classList.add('punch');
        setTimeout(() => hand.classList.remove('punch'), 150);
        punchSide = !punchSide;
        
        // Звук удара
        const a = new (window.AudioContext || window.webkitAudioContext)();
        const o = a.createOscillator(); const g = a.createGain();
        o.frequency.value = 100; g.gain.value = 0.1;
        o.connect(g); g.connect(a.destination); o.start(); o.stop(a.currentTime + 0.1);
    }

    function update() {
        // Вращение
        if (keys['KeyA']) player.dir -= 0.05;
        if (keys['KeyD']) player.dir += 0.05;

        // Движение
        let moveStep = 0;
        if (keys['KeyW']) moveStep = 0.04;
        if (keys['KeyS']) moveStep = -0.04;

        let newX = player.x + Math.cos(player.dir) * moveStep;
        let newY = player.y + Math.sin(player.dir) * moveStep;

        // Простая коллизия
        if (map[Math.floor(newY)][Math.floor(newX)] === 0) {
            player.x = newX;
            player.y = newY;
        }
    }

    function draw() {
        ctx.fillStyle = '#000';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        // Пол и потолок
        ctx.fillStyle = '#051005';
        ctx.fillRect(0, canvas.height/2, canvas.width, canvas.height/2);

        // Raycasting (рисуем стены)
        const numRays = 300;
        const fov = Math.PI / 3;
        
        for (let i = 0; i < numRays; i++) {
            let rayAngle = (player.dir - fov/2) + (i / numRays) * fov;
            let distanceToWall = 0;
            let hitWall = false;

            let eyeX = Math.cos(rayAngle);
            let eyeY = Math.sin(rayAngle);

            while (!hitWall && distanceToWall < 15) {
                distanceToWall += 0.1;
                let testX = Math.floor(player.x + eyeX * distanceToWall);
                let testY = Math.floor(player.y + eyeY * distanceToWall);

                if (testX < 0 || testX >= map[0].length || testY < 0 || testY >= map.length) {
                    hitWall = true; distanceToWall = 15;
                } else if (map[testY][testX] === 1) {
                    hitWall = true;
                }
            }

            // Коррекция эффекта рыбьего глаза
            distanceToWall *= Math.cos(rayAngle - player.dir);

            let ceiling = canvas.height / 2 - canvas.height / distanceToWall;
            let floor = canvas.height - ceiling;
            let wallHeight = floor - ceiling;

            // Цвет стен в зависимости от дистанции
            let brightness = Math.min(255, 2000 / distanceToWall);
            ctx.fillStyle = `rgb(0, ${brightness}, 65)`;
            ctx.fillRect(i * (canvas.width/numRays), ceiling, (canvas.width/numRays) + 1, wallHeight);
        }
    }

    function loop() {
        update();
        draw();
        requestAnimationFrame(loop);
    }

    loop();
</script>
</body>
</html>
