<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GHOST HUNTER: NARRATOR EDITION</title>
    <style>
        :root {
            --gold: #ffcc00; --blood: #af0000; --ghost: #8899cc;
            --bg: #0d0d0d; --panel: #1e1a17; --text: #d2b48c; --xp: #4caf50;
        }
        body {
            background: var(--bg); color: var(--text); font-family: 'Courier New', monospace;
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center;
            height: 100vh; width: 100vw; overflow: hidden;
        }
        #game-container {
            width: 1200px; height: 800px;
            background: var(--panel); border: 5px solid #3e2723; border-radius: 15px;
            padding: 30px; box-sizing: border-box; box-shadow: 0 0 50px rgba(0,0,0,0.9);
            position: relative; display: grid; grid-template-columns: 350px 1fr 350px; gap: 20px;
        }
        
        .side-panel { display: flex; flex-direction: column; gap: 15px; }
        .main-panel { display: flex; flex-direction: column; justify-content: space-between; position: relative; }

        .header { text-align: center; border-bottom: 3px solid #3e2723; padding-bottom: 10px; grid-column: span 3; }
        .header h1 { margin: 0; font-size: 32px; letter-spacing: 5px; color: var(--gold); }

        .stats-box { background: rgba(0,0,0,0.4); padding: 15px; border-radius: 8px; border: 1px solid #3e2723; }
        .stats-box div { margin: 8px 0; font-size: 18px; }
        
        .bar-bg { width: 100%; height: 15px; background: #222; border-radius: 10px; margin: 10px 0; overflow: hidden; border: 1px solid #444; }
        #sanity-fill { width: 0%; height: 100%; background: var(--ghost); transition: 0.5s; }
        #xp-fill { width: 0%; height: 100%; background: var(--xp); transition: 0.5s; }
        #enemy-hp-fill { width: 100%; height: 100%; background: var(--blood); transition: 0.3s; }

        #enemy-zone { 
            flex-grow: 1; display: none; flex-direction: column; align-items: center; justify-content: center;
            border: 2px dashed var(--blood); border-radius: 20px; margin: 20px 0; background: rgba(0,0,0,0.2);
        }
        
        #enemy-sprite { font-size: 150px; margin: 20px 0; transition: 0.3s; display: flex; align-items: center; justify-content: center; }

        .narrator-img {
            width: 300px; height: 300px; object-fit: contain;
            animation: narrator-float 2s infinite alternate ease-in-out;
            filter: drop-shadow(0 0 30px var(--gold)); border-radius: 20px;
        }
        @keyframes narrator-float { 
            from { transform: translateY(0) rotate(-1deg); } 
            to { transform: translateY(-25px) rotate(1deg); } 
        }

        #event-log {
            height: 400px; overflow-y: auto; background: rgba(0,0,0,0.6);
            border-left: 5px solid var(--blood); padding: 15px; font-size: 14px;
            display: flex; flex-direction: column-reverse; line-height: 1.6; border-radius: 5px;
        }

        .inventory { 
            display: grid; 
            grid-template-columns: repeat(4, 1fr); 
            gap: 10px; padding: 10px; background: #000; border-radius: 10px; 
            min-height: 70px;
        }
        .inv-slot { height: 60px; border: 2px solid #444; display: flex; align-items: center; justify-content: center; font-size: 30px; cursor: pointer; }

        .controls { display: grid; grid-template-columns: 1fr; gap: 10px; }
        button {
            background: #3e2723; color: var(--text); border: 2px solid #5d4037;
            padding: 20px; border-radius: 8px; cursor: pointer; font-weight: bold;
            text-transform: uppercase; font-size: 16px; transition: 0.2s;
        }
        button:hover { background: #5d4037; }
        button:active { background: var(--gold); color: black; }
        button:disabled { opacity: 0.5; cursor: default; }

        .overlay-menu { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 500px; background: #121a22; border: 3px solid var(--ghost);
            padding: 30px; z-index: 100; display: none; border-radius: 15px;
        }

        #ending {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: black; z-index: 2000; display: none; flex-direction: column;
            align-items: center; justify-content: center; text-align: center;
        }

        .shake { animation: shake 0.3s; }
        @keyframes shake { 0%, 100% { transform: translate(0,0); } 25% { transform: translate(10px, 10px); } 50% { transform: translate(-10px, -10px); } }
    </style>
</head>
<body>

<div id="game-container">
    <div class="header"><h1>üíÄ GHOST HUNTER: DEAD WEST</h1></div>

    <div class="side-panel">
        <div class="stats-box">
            <h2 style="margin:0; color:var(--gold)">HUNTER</h2>
            <div>Gold: $<span id="v-gold">0</span></div>
            <div>Ammo: <span id="v-ammo">0</span></div>
            <div>Level: <span id="v-lvl">1</span></div>
            <div>SP: <span id="v-sp">0</span></div>
            <div id="wpn-name" style="color:var(--gold)">Colt .45</div>
            <div id="pet-name" style="color:var(--ghost); font-size:14px;">No Companion</div>
        </div>
        <div class="stats-box">
            Sanity (Mental HP)
            <div class="bar-bg"><div id="sanity-fill"></div></div>
            Experience
            <div class="bar-bg"><div id="xp-fill"></div></div>
        </div>
        <h3>SADDLEBAGS</h3>
        <div id="inventory-ui" class="inventory"></div>
        <div style="display:flex; gap:10px; margin-top:20px;">
            <button onclick="save()">SAVE</button>
            <button onclick="load()">LOAD</button>
        </div>
    </div>

    <div class="main-panel">
        <div id="enemy-zone">
            <div id="enemy-sprite"></div>
            <h2 id="enemy-name" style="margin:0; font-size:32px;">GHOST</h2>
            <div class="bar-bg" style="width:80%; height:25px;"><div id="enemy-hp-fill"></div></div>
        </div>
        <div id="event-log"></div>
    </div>

    <div class="side-panel">
        <h3 style="text-align:center;">ACTIONS</h3>
        <div id="action-buttons" class="controls"></div>
    </div>

    <div id="skill-menu" class="overlay-menu">
        <h2 style="text-align:center; color:var(--xp)">SKILLS (SP: <span id="v-sp-menu">0</span>)</h2>
        <div class="controls">
            <button id="btn-doubleShot" onclick="learn('doubleShot')">Double Shot (1 SP)</button>
            <button id="btn-ironWill" onclick="learn('ironWill')">Iron Will (1 SP)</button>
            <button id="btn-extraSlot" onclick="upgradeInventory()">Expand Bags (Step 1: 2 SP)</button>
            <button onclick="closeUI()" style="margin-top:20px; background:#222">BACK</button>
        </div>
    </div>

    <div id="stable-menu" class="overlay-menu">
        <h2 style="text-align:center; color:var(--ghost)">STABLES</h2>
        <div class="controls">
            <button onclick="buyPet('dog')">üêï GHOST DOG ($150)</button>
            <button onclick="buyPet('raven')">üê¶ SHADOW RAVEN ($150)</button>
            <button onclick="closeUI()">BACK</button>
        </div>
    </div>
</div>

<div id="ending">
    <h1 style="font-size:60px; color:var(--gold)">THE STORY ENDS</h1>
    <p id="ending-msg" style="max-width:800px; font-size:24px; color:#ccc;"></p>
    <button onclick="location.reload()" style="font-size:24px; padding:30px;">START OVER</button>
</div>

<script>
    const NARRATOR_IMAGE_URL = "file:///Users/vadim/Downloads/Narrator.jpg";

    const initialState = {
        gold: 150,
        ammo: 30,
        sanity: 0,
        level: 1,
        xp: 0,
        xpNext: 100,
        sp: 0,
        baseAtk: 30,
        inventory: [],
        enemy: null,
        isNight: false,
        maxInv: 4,
        invLevel: 0,
        companion: null,
        hasCursedGun: false,
        hasRailgun: false,
        gameEnded: false,
        skills: {
            doubleShot: false,
            ironWill: false
        }
    };

    let state = JSON.parse(JSON.stringify(initialState));

    function log(msg, color = "#aaa") {
        const el = document.getElementById('event-log');
        el.innerHTML = `<div style="color:${color}">> ${msg}</div>` + el.innerHTML;
    }

    function save() {
        const saveState = JSON.parse(JSON.stringify(state));
        saveState.enemy = null;
        saveState.isNight = false;
        localStorage.setItem('GHOST_HUNTER_DB', JSON.stringify(saveState));
        log("DATABASE UPDATED: Progress locked in.", "var(--xp)");
    }

    function load() {
        const savedData = localStorage.getItem('GHOST_HUNTER_DB');
        if (savedData) {
            state = JSON.parse(savedData);
            
            // –ü–†–û–í–ï–†–ö–ê –ù–û–í–´–• –ü–û–õ–ï–ô (—á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ undefined)
            if (state.invLevel === undefined) {
                state.invLevel = 0;
            }
            if (state.maxInv === undefined) {
                state.maxInv = 4;
            }
            
            updateDisplay();
            log("DATABASE LOADED: Welcome back, Hunter.", "var(--gold)");
        } else {
            log("No save file found in database.", "red");
        }
    }

    function upgradeInventory() {
        const costs = [2, 4, 8];
        
        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—É—â–µ—Å—Ç–≤—É—é—Ç
        if (state.invLevel === undefined) { state.invLevel = 0; }
        if (state.maxInv === undefined) { state.maxInv = 4; }

        // –ï—Å–ª–∏ —É–∂–µ –∫—É–ø–∏–ª–∏ –≤—Å–µ 3 —É—Ä–æ–≤–Ω—è
        if (state.invLevel >= costs.length) {
            log("Inventory is already at maximum capacity!", "var(--gold)");
            return;
        }

        const currentCost = costs[state.invLevel];

        if (state.sp >= currentCost) {
            state.sp = state.sp - currentCost;
            state.invLevel = state.invLevel + 1;
            state.maxInv = state.maxInv + 1;
            log("INVENTORY EXPANDED: +1 Slot added!", "var(--xp)");
            updateDisplay();
        } else {
            log("Need " + currentCost + " SP for this expansion!", "red");
        }
    }

    function updateDisplay() {
        if (state.gameEnded === true) {
            return;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø–æ–ª–µ–π
        document.getElementById('v-gold').innerText = state.gold;
        document.getElementById('v-ammo').innerText = state.ammo;
        document.getElementById('v-lvl').innerText = state.level;
        document.getElementById('v-sp').innerText = state.sp;
        document.getElementById('v-sp-menu').innerText = state.sp;

        // –û—Ä—É–∂–∏–µ
        let weaponDisplay = "COLT .45";
        if (state.hasRailgun === true) {
            weaponDisplay = "‚ö° RAILGUN";
        } else if (state.hasCursedGun === true) {
            weaponDisplay = "üíÄ SOUL EATER";
        }
        document.getElementById('wpn-name').innerText = weaponDisplay;

        // –ü–∏—Ç–æ–º–µ—Ü
        if (state.companion) {
            document.getElementById('pet-name').innerText = "PET: " + state.companion.toUpperCase();
        } else {
            document.getElementById('pet-name').innerText = "NO COMPANION";
        }
        
        // –ü–æ–ª–æ—Å–∫–∏ HP –∏ XP
        document.getElementById('sanity-fill').style.width = state.sanity + '%';
        document.getElementById('xp-fill').style.width = (state.xp / state.xpNext * 100) + '%';
        
        // –ò–Ω–≤–µ–Ω—Ç–∞—Ä—å
        const invContainer = document.getElementById('inventory-ui');
        invContainer.innerHTML = '';
        
        // –†–∏—Å—É–µ–º –∑–∞–Ω—è—Ç—ã–µ —Å–ª–æ—Ç—ã
        for (let i = 0; i < state.inventory.length; i++) {
            const slot = document.createElement('div');
            slot.className = 'inv-slot';
            if (state.inventory[i] === 'tnt') {
                slot.innerHTML = 'üß®';
            } else {
                slot.innerHTML = 'ü•É';
            }
            slot.onclick = function() { useItem(i); };
            invContainer.appendChild(slot);
        }
        
        // –†–∏—Å—É–µ–º –ø—É—Å—Ç—ã–µ —Å–ª–æ—Ç—ã (–¥–æ —Ç–µ–∫—É—â–µ–≥–æ –ª–∏–º–∏—Ç–∞ maxInv)
        for (let i = state.inventory.length; i < state.maxInv; i++) {
            const emptySlot = document.createElement('div');
            emptySlot.className = 'inv-slot';
            emptySlot.style.opacity = "0.2";
            invContainer.appendChild(emptySlot);
        }

        // –í—Ä–∞–≥
        const enemyZone = document.getElementById('enemy-zone');
        if (state.enemy) {
            enemyZone.style.display = 'flex';
            document.getElementById('enemy-name').innerText = state.enemy.name;
            document.getElementById('enemy-hp-fill').style.width = (state.enemy.hp / state.enemy.maxHp * 100) + '%';
            
            const spriteCont = document.getElementById('enemy-sprite');
            if (state.enemy.name === "NARRATOR") {
                spriteCont.innerHTML = '<img src="' + NARRATOR_IMAGE_URL + '" class="narrator-img">';
            } else {
                spriteCont.innerHTML = state.enemy.icon;
            }
        } else {
            enemyZone.style.display = 'none';
        }

        // –ö–Ω–æ–ø–∫–∞ –∞–ø–≥—Ä–µ–π–¥–∞ –∏–Ω–≤–µ–Ω—Ç–∞—Ä—è –≤ –º–µ–Ω—é
        const exBtn = document.getElementById('btn-extraSlot');
        const costs = [2, 4, 8];
        const currentLevel = state.invLevel || 0;

        if (currentLevel >= 3) {
            exBtn.innerText = "INVENTORY MAXED OUT";
            exBtn.disabled = true;
        } else {
            exBtn.innerText = "Expand Bags (Step " + (currentLevel + 1) + ": " + costs[currentLevel] + " SP)";
            exBtn.disabled = false;
        }

        // –ù–∞–≤—ã–∫–∏
        document.getElementById('btn-doubleShot').disabled = state.skills.doubleShot;
        document.getElementById('btn-ironWill').disabled = state.skills.ironWill;

        renderButtons();
    }

    function renderButtons() {
        const btns = document.getElementById('action-buttons');
        let htmlCode = '';

        if (state.enemy) {
            htmlCode += '<button onclick="attack(\'shoot\')">üî• SHOOT</button>';
            if (state.hasRailgun) {
                htmlCode += '<button onclick="attack(\'railgun\')" style="background:#00bcd4; color:black">‚ö° RAILGUN SHOT</button>';
            }
            if (state.hasCursedGun) {
                htmlCode += '<button onclick="attack(\'cursed\')" style="background:#4a148c">üíÄ SOUL BLAST</button>';
            }
            if (state.skills.doubleShot) {
                htmlCode += '<button onclick="attack(\'double\')">üî• DOUBLE SHOT</button>';
            }
            htmlCode += '<button onclick="attack(\'dodge\')">üèÉ DODGE</button>';
        } else if (state.isNight === false) {
            htmlCode += '<button onclick="shop(\'ammo\')">üõí BUY AMMO ($25)</button>';
            htmlCode += '<button onclick="shop(\'tnt\')">üß® BUY DYNAMITE ($50)</button>';
            htmlCode += '<button onclick="shop(\'whiskey\')">ü•É BUY WHISKEY ($40)</button>';
            htmlCode += '<button onclick="document.getElementById(\'stable-menu\').style.display=\'block\'">üêï STABLES</button>';
            htmlCode += '<button onclick="document.getElementById(\'skill-menu\').style.display=\'block\'">‚≠ê UPGRADES</button>';
            
            if (state.level >= 8 && state.hasRailgun === false) {
                htmlCode += '<button onclick="shop(\'railgun\')" style="color:#00bcd4;">‚ö° BUY RAILGUN ($3000)</button>';
            }
            htmlCode += '<button onclick="startHunt()" style="background:#333; color:var(--ghost)">üåô START HUNT</button>';
        } else {
            htmlCode += '<button onclick="scout()" style="padding:40px;">üîç SCOUT AREA</button>';
            htmlCode += '<button onclick="returnToTown()">üèÉ RETURN TO TOWN</button>';
        }
        btns.innerHTML = htmlCode;
    }

function shop(type) {
    // 1. –ü–†–û–í–ï–†–ö–ê –ú–ï–°–¢–ê –í –ò–ù–í–ï–ù–¢–ê–†–ï (–¥–ª—è –¥–∏–Ω–∞–º–∏—Ç–∞ –∏ –≤–∏—Å–∫–∏)
    if (type === 'tnt' || type === 'whiskey') {
        if (state.inventory.length >= state.maxInv) {
            log("No space in saddlebags!", "red");
            return; // –ü—Ä–µ–∫—Ä–∞—â–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –ø–æ–∫—É–ø–∫–∞ –Ω–µ —Å–æ—Å—Ç–æ–∏—Ç—Å—è
        }
    }

    // 2. –ü–û–ö–£–ü–ö–ê –ü–ê–¢–†–û–ù–û–í
    if (type === 'ammo') {
        if (state.gold >= 25) {
            state.gold = state.gold - 25;
            state.ammo = state.ammo + 20;
            log("Bought 20 ammo.", "var(--text)");
        } else {
            log("Not enough gold for ammo!", "red");
        }
    } 

    // 3. –ü–û–ö–£–ü–ö–ê –î–ò–ù–ê–ú–ò–¢–ê
    else if (type === 'tnt') {
        if (state.gold >= 50) {
            state.gold = state.gold - 50;
            state.inventory.push('tnt');
            log("Bought Dynamite!", "orange");
        } else {
            log("Not enough gold for Dynamite!", "red");
        }
    } 

    // 4. –ü–û–ö–£–ü–ö–ê –í–ò–°–ö–ò
    else if (type === 'whiskey') {
        if (state.gold >= 40) {
            state.gold = state.gold - 40;
            state.inventory.push('whiskey');
            log("Bought Whiskey!", "var(--ghost)");
        } else {
            log("Not enough gold for Whiskey!", "red");
        }
    } 

    // 5. –ü–û–ö–£–ü–ö–ê RAILGUN (—Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –ø–æ–∫—É–ø–∫–∏)
    else if (type === 'railgun') {
        if (state.hasRailgun === true) {
            log("You already have the Railgun!", "var(--gold)");
            return;
        }
        if (state.gold >= 3000) {
            state.gold = state.gold - 3000;
            state.hasRailgun = true;
            log("EQUIPPED: ‚ö° RAILGUN.", "#00bcd4");
        } else {
            log("Not enough gold for Railgun!", "red");
        }
    }

    updateDisplay();
}

    function attack(method) {
        let damage = state.baseAtk + (Math.random() * 20);
        if (state.companion === 'dog') { damage = damage + 20; }

        if (method === 'shoot') {
            if (state.ammo >= 1) { state.ammo = state.ammo - 1; } 
            else { log("Out of ammo!", "red"); return; }
        } else if (method === 'double') {
            if (state.ammo >= 2) { state.ammo = state.ammo - 2; damage = damage * 2.5; } 
            else { log("Not enough ammo!", "red"); return; }
        } else if (method === 'railgun') {
            if (state.ammo >= 100) { state.ammo = state.ammo - 100; damage = 300; } 
            else { log("Need 100 ammo!", "red"); return; }
        }

        if (state.enemy) {
            state.enemy.hp = state.enemy.hp - damage;
            if (state.enemy.hp <= 0) {
                log("Spirit banished!");
                state.gold = state.gold + 70;
                state.xp = state.xp + 50;
                state.enemy = null;
                if (state.xp >= state.xpNext) {
                    state.level = state.level + 1;
                    state.sp = state.sp + 1;
                    state.xp = 0;
                    state.xpNext = state.xpNext * 1.5;
                }
            } else {
                enemyTurn();
            }
        }
        updateDisplay();
    }

    function enemyTurn() {
        let damage = 15 + (state.level * 2);
        if (state.skills.ironWill === true) {
            damage = damage * 0.6;
        }
        state.sanity = state.sanity + Math.floor(damage);
        if (state.sanity >= 100) {
            alert("GAME OVER. Darkness took you.");
            state.gameEnded = true;
            location.reload();
        }
    }

    function useItem(index) {
        const item = state.inventory[index];
        if (item === 'tnt' && state.enemy) {
            state.enemy.hp = state.enemy.hp - 300;
            log("DYNAMITE EXPLODED!", "orange");
            if (state.enemy.hp <= 0) { state.enemy = null; }
        } else if (item === 'whiskey') {
            state.sanity = state.sanity - 35;
            if (state.sanity < 0) { state.sanity = 0; }
            log("Whiskey calmed your nerves.");
        }
        state.inventory.splice(index, 1);
        updateDisplay();
    }

    function learn(skill) {
        if (state.sp >= 1 && state.skills[skill] === false) {
            state.sp = state.sp - 1;
            state.skills[skill] = true;
            log("Learned " + skill + "!", "var(--xp)");
            updateDisplay();
        }
    }

    function scout() {
        state.sanity = state.sanity + 5;
        if (Math.random() > 0.5) {
            let hp = 150 + (state.level * 20);
            state.enemy = { name: "GHOST", icon: "üëª", hp: hp, maxHp: hp };
            log("A spirit emerged from the fog!");
        } else {
            state.gold = state.gold + 40;
            log("Found some gold coins.");
        }
        updateDisplay();
    }

    function startHunt() { state.isNight = true; updateDisplay(); }
    function returnToTown() { state.isNight = false; state.sanity = 0; updateDisplay(); }
    function closeUI() { 
        document.getElementById('skill-menu').style.display = 'none'; 
        document.getElementById('stable-menu').style.display = 'none'; 
    }

    window.onload = load;
    updateDisplay();
</script>
</body>
</html>
